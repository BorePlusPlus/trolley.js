/* trolley.js v0.0.2 - https://github.com/BorePlusPlus/trolley.js - Copyright (c) 2013, Dalibor "BorePlusPlus" Novak, License: BSD 3-clause */
!function(a,b){"use strict";function c(a){return a.name.toUpperCase().indexOf("QUOTA")>=0}function d(){return"object"==typeof JSON&&"function"==typeof JSON.parse}function e(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),d()}catch(a){return c(a)&&d()}}function f(a){var b;for(b in localStorage)0===b.indexOf(r)&&a(b,JSON.parse(localStorage[b]))}function g(a,b){var d,e,h=Number.MAX_VALUE,i=r+a;if(o)try{localStorage[i]=b}catch(j){c(j)&&(f(function(a,b){e=b.fetched,!b.namespace&&h>e&&(d=a,h=e)}),d&&(localStorage.removeItem(d),g(a,b)))}}function h(a){var b=r+a;return o&&localStorage[b]}function i(a){f(function(b,c){c.namespace===a&&localStorage.removeItem(b)})}function j(a){var b,c,d=r+"version";return o&&a?(b=a.namespace,c=JSON.parse(localStorage[d]||"{}")[b],c?c!==a.version?(i(b),!0):!1:!0):!1}function k(a){var b,c=r+"version";o&&a&&(b=JSON.parse(localStorage[c]||"{}"),b[a.namespace]=a.version,localStorage[c]=JSON.stringify(b))}function l(){return a.XMLHttpRequest?new a.XMLHttpRequest:new a.ActiveXObject("Microsoft.XMLHTTP")}function m(a){var c=b.createElement("script");c.setAttribute("type","text/javascript"),c.text=a,q.appendChild(c)}function n(a){var c=b.createElement("style");c.setAttribute("type","text/css"),q.appendChild(c),c.styleSheet?c.styleSheet.cssText=a:c.innerHTML=a}var o=e(),p={"application/javascript":m,"text/css":n},q=b.head||b.getElementsByTagName("head")[0],r="trolleyjs-";a.trolleyjs=function(a,b){function c(a){var b=a.url,c=s[b];for(r[b]=a;c&&c.length;)c.pop()(a)}function d(a,b,c){var d=q[c];d.storedObj=a,d.fileObj=b;for(var f=0,g=q.length;g>f;f++)if(d=q[f],!d.inserted){if(a=d.storedObj,!a)break;e(a,d.fileObj),d.inserted=!0,delete d.storedObj}}function e(a,d){(p[a.type]||function(){})(a.content),d.callback&&d.callback(d),c(d),t&&0===--o&&k(b)}function f(a,b,c){b.immediate?e(a,b):d(a,b,c)}function i(a,c){var d,e=l();e.open("GET",a.url,!a.sync),e.onreadystatechange=function(){if(4===e.readyState){if(200!==e.status)throw new Error(e.statusText);d={content:e.responseText,type:a.type||e.getResponseHeader("content-type"),fetched:+new Date,namespace:b&&b.namespace},g(a.url,JSON.stringify(d)),f(d,a,c)}},setTimeout(function(){e.readyState<4&&e.abort()},15e3),e.send()}function m(a){function c(a){return a&&(!b||b.namespace===a.namespace)}var d,e=q.length;return a.immediate||(q[e]={inserted:!1}),d=JSON.parse(h(a.url)||"false"),c(d)?f(d,a,e):(i(a,e),void 0)}function n(a,b){var c=r[a],d=s[a];return c?b(c):(d||(s[a]=d=[]),d.push(b),void 0)}var o,q=[],r={},s={},t=!1;a instanceof Array||(a=arguments,b=null),o=a.length,t=j(b);for(var u=0,v=a.length;v>u;u++)m(a[u]);return{whenLoaded:n}}}(this,document);